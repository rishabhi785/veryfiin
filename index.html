<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@fingerprintjs/fingerprintjs@3/dist/fp.min.js"></script>
<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    // Initialize fingerprint
    FingerprintJS.load().then(fp => {
        fp.get().then(result => {
            const visitorId = result.visitorId;

            // Send to backend
            fetch("http://brownglider.onpella.app/verify", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    user_id: tg.initDataUnsafe.user.id,
                    fingerprint: visitorId,
                }),
            })
            .then(res => res.json())
            .then(data => {
                if (data.status === "success") {
                    tg.showAlert("✅ Device verified successfully!");
                } else {
                    tg.showAlert("⚠️ " + data.message);
                }
            })
            .catch(error => {
                tg.showAlert("❌ Verification failed. Try again.");
                console.error(error);
            });
        });
    });
</script>
